name: Storybook CI

on:
  pull_request:
    branches:
      - main
      - develop

jobs:
  build-and-test-storybook:
    runs-on: ubuntu-latest

    steps:
      # μ €μ¥μ† μ²΄ν¬μ•„μ›ƒ
      - name: Checkout Repository
        uses: actions/checkout@v3

      # Node.js μ„¤μ •
      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      # μμ΅΄μ„± μ„¤μΉ
      - name: Install Dependencies
        run: npm install

      # Storybook λΉλ“
      - name: Build Storybook
        run: npm run build-storybook

      # Chromaticμ— λ°°ν¬
      - name: Publish to Chromatic
        id: chromatic
        uses: chromaui/action@v1
        with:
          projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}
          token: ${{ secrets.PR_ACTION_TOKEN }}

      # PRμ— λ°°ν¬ λ§ν¬ μ½”λ©νΈ μ¶”κ°€
      - name: Comment PR with Storybook URL
        uses: thollander/actions-comment-pull-request@v1
        env:
          GITHUB_TOKEN: ${{ secrets.PR_ACTION_TOKEN }}
        with:
          message: "π€ Storybook λ°°ν¬ μ™„λ£: ${{ steps.chromatic.outputs.storybookUrl }}"

      # ESLint μ½”λ“ ν’μ§ κ²€μ‚¬
      - name: Run ESLint
        run: npm run lint

      # Slack μ•λ¦Ό μ „μ†΅ (μµμ…)
      - name: Slack Notification
        if: always()
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK }}
          SLACK_CHANNEL: '#λΌμ¤νΈν΅'
          SLACK_COLOR: ${{ job.status == 'success' && 'good' || 'danger' }}
          SLACK_MESSAGE: "Storybook ν…μ¤νΈ ${{ job.status }}!"